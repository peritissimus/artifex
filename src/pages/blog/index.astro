---
import Base from '../../layouts/Base.astro';
import { getCollection } from 'astro:content';

// Get all blog posts, sorted by date (newest first)
const allPosts = await getCollection('blog', ({ data }) => !data.draft);
const sortedPosts = allPosts.sort(
  (a, b) => new Date(b.data.date).valueOf() - new Date(a.data.date).valueOf()
);

function formatDate(date: Date): string {
  const year = date.getFullYear();
  const month = String(date.getMonth() + 1).padStart(2, '0');
  const day = String(date.getDate()).padStart(2, '0');
  return `${year}-${month}-${day}`;
}
---

<Base
  title="Blog - Peritissimus"
  description="Technical writings and thoughts on AI, system architecture, and software engineering by Kushal Patankar."
  ogImage="/og/blog.png"
  currentPath="/blog"
>
  <section id="blog" class="content-section">
    <div class="section-inner">
      <div class="blog-header">
        <div class="blog-header-top">
          <span class="blog-label">[SYS//BLOG]</span>
          <span class="blog-count">
            <span class="count-indicator"></span>
            {sortedPosts.length} ENTRIES
          </span>
        </div>
        <h2 class="section-title">Technical Log</h2>
        <p class="blog-description">
          Thoughts on AI, system architecture, and building scalable products.
        </p>
      </div>

      <div class="blog-grid">
        {sortedPosts.map((post) => (
          <article class="blog-card">
            <a href={`/blog/${post.slug}`} class="blog-card-link">
              <div class="blog-card-header">
                <span class="blog-date">[{formatDate(post.data.date)}]</span>
                <span class="blog-tag">[{post.data.category || 'AI/LLM'}]</span>
              </div>
              <h3 class="blog-title">> {post.data.title}</h3>
              <p class="blog-excerpt">{post.data.description}</p>
              <div class="blog-meta">
                <span class="read-time">{post.data.readTime || '5 min read'}</span>
                <span class="meta-separator">|</span>
                <span class="blog-topics">{post.data.tags.slice(0, 3).join(', ')}</span>
              </div>
            </a>
          </article>
        ))}
      </div>

      <div class="blog-footer">
        <span class="footer-info">SYSTEM_STATUS: More articles coming soon...</span>
      </div>
    </div>
  </section>
</Base>
